<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<link rel="icon" href="/pagecontent/resources/images/logo.png">
<title>Login / Apply</title>
<link rel="stylesheet" href="/pagecontent/stylesheets/global.css">
<link rel="stylesheet" href="/pagecontent/stylesheets/fonts.css">
<link rel="stylesheet" href="/pagecontent/stylesheets/stylesheet-loginpage.css">
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

<script>
  document.documentElement.classList.add('js');
  window.addEventListener('load', function () {
    document.body.classList.add('fade-in');
  });
</script>
</head>
<body>

<!-- Back button -->
<button id="backtoPrevious">
  <link rel="stylesheet" href="/pagecontent/stylesheets/navbar.css">
  <a href="/"><span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.5em;">arrow_back_ios</span> Back </a>
  <script>
    document.getElementById('backtoPrevious').addEventListener('click', function() {
      window.history.back();
    });
  </script>
</button>

<section id="section1">
  <div class="s1-background">
    <img src="/pagecontent/resources/images/illustration-flat-img.png" alt="">
  </div>

  <div id="notice" class="notice;"></div>

  <div class="form-container">
    <img src="/pagecontent/resources/images/vultrlogo.png" alt="Logo" class="form-logo" style="width: 100px;">
    <div class="form-title" id="formTitle">Apply for Access</div>

    <!-- Apply Form -->
    <form id="applyForm">
      <input type="text" placeholder="Name" required id="applyName">
      <input type="email" placeholder="Email" required id="applyEmail">
      <select id="applyType" required>
        <option value="individual">Individual</option>
        <option value="business">Business</option>
      </select>
      <button type="submit">
        Apply
        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.2em;">arrow_right_alt</span>
      </button>
            <span class="form-notice">By applying you agree to our <a href="">terms of services</a> and <a href="">privacy policy</a></span>
    </form>

    <!-- Login Form -->
    <form id="loginForm" style="display:none;">
      <input type="email" placeholder="Email" required id="loginEmail">
      <input type="password" placeholder="Password" required id="loginPassword">
      <button type="submit">
        Log In
        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.2em;">arrow_right_alt</span>
      </button>
    </form>

    <button class="switch-btn" id="switchBtn">Already have an account? Login</button>
  </div>
</section>    

<script>
  // Country restriction logic
  fetch('/signup-country')
    .then(res => res.json())
    .then(data => {
      if(data.blocked) {
        const notice = document.getElementById('notice');
        notice.className = 'notice';
        notice.innerHTML = `<span class="material-symbols-outlined" style="vertical-align:middle;font-size:1.2em;color:#f75454;">warning</span> Signup from your country (${data.country}) is restricted. Read More <a href="/terms-of-services#Account-Creation" target="">here</a>.`;          
        document.getElementById('applyForm').querySelector('button[type="submit"]').disabled = true;
      }
    });

  // Switch between apply and login
  const applyForm = document.getElementById('applyForm');
  const loginForm = document.getElementById('loginForm');
  const switchBtn = document.getElementById('switchBtn');
  const formTitle = document.getElementById('formTitle');

  let isApply = true;

  switchBtn.addEventListener('click', () => {
    isApply = !isApply;
    if(isApply) {
      applyForm.style.display = '';
      loginForm.style.display = 'none';
      switchBtn.textContent = 'Already have an account? Login';
      formTitle.textContent = 'Apply for Access';
      history.replaceState(null, '', '?mode=apply');
    } else {
      applyForm.style.display = 'none';
      loginForm.style.display = '';
      switchBtn.textContent = 'Need access? Apply';
      formTitle.textContent = 'Welcome Back!';
      history.replaceState(null, '', '?mode=login');
    }
  });


  // Check URL on page load
const urlParams = new URLSearchParams(window.location.search);
const mode = urlParams.get("mode");

if (mode === "login") {
  isApply = false;
  applyForm.style.display = "none";
  loginForm.style.display = "";
  switchBtn.textContent = "Need access? Apply";
  formTitle.textContent = "Welcome Back!";
} else {
  // default to apply mode
  isApply = true;
  applyForm.style.display = "";
  loginForm.style.display = "none";
  switchBtn.textContent = "Already have an account? Login";
  formTitle.textContent = "Apply for Access";
}


  // Handle Apply form submission
  applyForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('applyName').value;
    const email = document.getElementById('applyEmail').value;
    const type = document.getElementById('applyType').value;

    if(!name || !email || !type) {
      alert('Please fill in all fields.');
      return;
    }

    fetch('/api/apply', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, type })
    })
    .then(res => res.json())
    .then(data => {
      if(data.success) {
        alert('Application submitted! Weâ€™ll get back to you soon.');
        applyForm.reset();
      } else {
        alert(`Application failed: ${data.message}`);
      }
    })
    .catch(err => {
      console.error('Error during application:', err);
      alert('An error occurred. Please try again later.');
    });
  });

  // Handle Login form submission
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if(!email || !password) {
      alert('Please fill in all fields.');
      return;
    }

    fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    })
    .then(res => res.json())
    .then(data => {
      if(data.success) {
        window.location.href = '/account';
      } else {
        alert(`Login failed: ${data.message}`);
      }
    })
    .catch(err => {
      console.error('Error during login:', err);
      alert('An error occurred. Please try again later.');
    });
  });
</script>

<button id="scrollToTopBtn">Back to Top</button>
<link rel="stylesheet" href="/pagecontent/stylesheets/backtotopbtn.css">
<script src="/pagecontent/scriptsheets/backtotopbtn.js"></script>

<div id="footer-container"></div>
<script src="/pagecontent/scriptsheets/global-footer.js"></script>
<link rel="stylesheet" href="/pagecontent/stylesheets/footer.css">
</body>
</html>
